See ZwFlushKey in NT DDK or 2000 DDK for detailed description.
