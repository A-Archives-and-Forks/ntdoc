<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtCreateThreadEx - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtCreateThreadEx - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtCreateThreadEx - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><div class="ntdoc-code-header">#ifndef _NTPSAPI_H
// User processes and threads
#if (PHNT_MODE != PHNT_MODE_KERNEL)
#if (PHNT_VERSION &gt;= PHNT_VISTA)

</div><div class="ntdoc-code-intro"></div><div class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus">NTSTATUS</a>
NTAPI
NtCreateThreadEx(
    _Out_ PHANDLE ThreadHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_opt_ <a href="object_attributes">POBJECT_ATTRIBUTES</a> ObjectAttributes,
    _In_ HANDLE ProcessHandle,
    _In_ <a href="puser_thread_start_routine">PUSER_THREAD_START_ROUTINE</a> StartRoutine,
    _In_opt_ PVOID Argument,
    _In_ ULONG CreateFlags, // THREAD_CREATE_FLAGS_*
    _In_ SIZE_T ZeroBits,
    _In_ SIZE_T StackSize,
    _In_ SIZE_T MaximumStackSize,
    _In_opt_ <a href="ps_attribute_list">PPS_ATTRIBUTE_LIST</a> AttributeList
    );
</div><div class="ntdoc-code-footer">
#endif
#endif
#endif
</div></code></pre><div class="ntdoc-code-links"><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/904c4c50849a7bd7f602732a4793ea3999547b63/phnt/include/ntpsapi.h#L2303">View code on GitHub</a></div></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><div class="ntdoc-code-header">#ifndef _NTZWAPI_H

</div><div class="ntdoc-code-intro"></div><div class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus">NTSTATUS</a>
NTAPI
ZwCreateThreadEx(
    _Out_ PHANDLE ThreadHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_opt_ <a href="object_attributes">POBJECT_ATTRIBUTES</a> ObjectAttributes,
    _In_ HANDLE ProcessHandle,
    _In_ <a href="puser_thread_start_routine">PUSER_THREAD_START_ROUTINE</a> StartRoutine,
    _In_opt_ PVOID Argument,
    _In_ ULONG CreateFlags, // THREAD_CREATE_FLAGS_*
    _In_ SIZE_T ZeroBits,
    _In_ SIZE_T StackSize,
    _In_ SIZE_T MaximumStackSize,
    _In_opt_ <a href="ps_attribute_list">PPS_ATTRIBUTE_LIST</a> AttributeList
    );
</div><div class="ntdoc-code-footer">
#endif
</div></code></pre><div class="ntdoc-code-links"><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/904c4c50849a7bd7f602732a4793ea3999547b63/phnt/include/ntzwapi.h#L1256">View code on GitHub</a></div></div>
</div>
<div class="ntdoc-description">
<p>Creates a new thread in the specified process.</p>

<h1 id="parameters">Parameters</h1>

<ul>
<li><code>ThreadHandle</code> - a pointer to a variable that receives a handle to the new thread.</li>
<li><code>DesiredAccess</code> - the thread access mask to provide on the returned handle. This value is usually <code>THREAD_ALL_ACCESS</code>.</li>
<li><code>ObjectAttributes</code> - an optional pointer to an <code><a href="object_attributes">OBJECT_ATTRIBUTES</a></code> structure that specifies attributes for the new object/handle, such as the security descriptor and handle inheritance.</li>
<li><code>ProcessHandle</code> - a handle to the process where the thread should be created. This can either be the <code><a href="ntcurrentprocess">NtCurrentProcess</a></code> pseudo-handle or a handle with <code><a href="process_create_thread">PROCESS_CREATE_THREAD</a></code> access.</li>
<li><code>StartRoutine</code> - the function to execute on the new thread.</li>
<li><code>Argument</code> - a user-provided argument to pass to the thread start routine.</li>
<li><code>CreateFlags</code> - a bit mask that control the properties of the new thread or its creation. See below.</li>
<li><code>ZeroBits</code> - the number of high-order address bits that must be zero in the base address of the thread's stack. Note that when the value is larger than 32, it becomes a bit mask.</li>
<li><code>StackSize</code> - the initial size of the stack, in bytes. The system rounds this value up to the nearest page. If this parameter is zero, the new thread uses the default size for the executable.</li>
<li><code>MaximumStackSize</code> - the maximum size of the stack, in bytes. The system rounds this value up to the nearest page. If this parameter is zero, the new thread uses the default size for the executable.</li>
<li><code>AttributeList</code> - an optional pointer to a buffer that defines a list of <code><a href="ps_attribute">PS_ATTRIBUTE</a></code> structures that control various aspects of thread creation and allow retrieving information about the new thread.</li>
</ul>

<h1 id="creation-flags">Creation flags</h1>

<ul>
<li><code><a href="thread_create_flags_create_suspended">THREAD_CREATE_FLAGS_CREATE_SUSPENDED</a></code> - create the thread in a suspended state instead of allowing it to execute immediately.</li>
<li><code><a href="thread_create_flags_skip_thread_attach">THREAD_CREATE_FLAGS_SKIP_THREAD_ATTACH</a></code> - the thread should skip calling loaded modules with <code>DLL_THREAD_ATTACH</code> reason.</li>
<li><code><a href="thread_create_flags_hide_from_debugger">THREAD_CREATE_FLAGS_HIDE_FROM_DEBUGGER</a></code> - suppress generation of debug events on the thread.</li>
<li><code><a href="thread_create_flags_loader_worker">THREAD_CREATE_FLAGS_LOADER_WORKER</a></code> - set the corresponding flag in <code><a href="teb">TEB</a></code>.</li>
<li><code><a href="thread_create_flags_skip_loader_init">THREAD_CREATE_FLAGS_SKIP_LOADER_INIT</a></code> - set the corresponding flag in <code><a href="teb">TEB</a></code>.</li>
<li><code><a href="thread_create_flags_bypass_process_freeze">THREAD_CREATE_FLAGS_BYPASS_PROCESS_FREEZE</a></code> - the thread should not be suspended when the system suspends or freezes the process.</li>
</ul>

<p>Check the corresponding pages for more details.</p>

<h1 id="supported-attributes">Supported attributes</h1>

<ul>
<li><code><a href="ps_attribute_client_id">PS_ATTRIBUTE_CLIENT_ID</a></code> - allows retrieving the <code><a href="client_id">CLIENT_ID</a></code> of the new thread.</li>
<li><code><a href="ps_attribute_teb_address">PS_ATTRIBUTE_TEB_ADDRESS</a></code> - allows retrieving the <code><a href="teb">TEB</a></code> address of the new thread.</li>
<li><code><a href="ps_attribute_ideal_processor">PS_ATTRIBUTE_IDEAL_PROCESSOR</a></code> - allows specifying the ideal processor for new thread.</li>
<li><code><a href="ps_attribute_ums_thread">PS_ATTRIBUTE_UMS_THREAD</a></code> - controls user-mode thread scheduling.</li>
<li><code><a href="ps_attribute_enable_optional_xstate_features">PS_ATTRIBUTE_ENABLE_OPTIONAL_XSTATE_FEATURES</a></code> - controls extended thread context features.</li>
</ul>

<p>Check the corresponding pages for more details.</p>

<h1 id="remarks">Remarks</h1>

<p>To avoid retaining unused resources, call <code><a href="ntclose">NtClose</a></code> to close the returned handle when it is no longer required.</p>

<p>For the legacy equivalent of this function, see <code><a href="ntcreatethread">NtCreateThread</a></code>.</p>

<h1 id="related-win32-api">Related Win32 API</h1>

<ul>
<li><a href="https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethreadex"><code>CreateRemoteThreadEx</code></a></li>
</ul>

<h1 id="see-also">See also</h1>

<ul>
<li><code><a href="ntcreatethread">NtCreateThread</a></code></li>
<li><code><a href="rtlcreateuserthread">RtlCreateUserThread</a></code></li>
<li><code><a href="ntresumethread">NtResumeThread</a></code></li>
<li><code><a href="ntopenthread">NtOpenThread</a></code></li>
<li><code><a href="ntopenprocess">NtOpenProcess</a></code></li>
<li><code><a href="ntcreateuserprocess">NtCreateUserProcess</a></code></li>
</ul>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntcreatethreadex.md">Edit description on GitHub</a>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
