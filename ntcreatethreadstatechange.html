<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtCreateThreadStateChange - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtCreateThreadStateChange - NtDoc</title>
    <link rel="shortcut icon" href="favicon.ico">
    <script src="dark-mode-toggle-preload.js"></script>
    <script>
        document.write(getStylesheetTagsForDarkModeToggle(
            'modules/water-2.1.1-light.css',
            'modules/water-2.1.1-dark.css',
        ));
    </script>
    <noscript>
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtCreateThreadStateChange - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><div class="ntdoc-code-header">#ifndef _NTPSAPI_H
#if (PHNT_VERSION &gt;= PHNT_WIN11)

</div><div class="ntdoc-code-intro"></div><div class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus">NTSTATUS</a>
NTAPI
NtCreateThreadStateChange(
    _Out_ PHANDLE ThreadStateChangeHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_opt_ <a href="object_attributes">POBJECT_ATTRIBUTES</a> ObjectAttributes,
    _In_ HANDLE ThreadHandle,
    _In_opt_ ULONG64 Reserved
    );
</div><div class="ntdoc-code-footer">
#endif
#endif
</div></code></pre><div class="ntdoc-code-links"><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/180fe591126a8293c20073893ee575cc0b101dce/phnt/include/ntpsapi.h#L1542">View code on GitHub</a></div></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><div class="ntdoc-code-header">#ifndef _NTZWAPI_H

</div><div class="ntdoc-code-intro"></div><div class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus">NTSTATUS</a>
NTAPI
ZwCreateThreadStateChange(
    _Out_ PHANDLE ThreadStateChangeHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_opt_ <a href="object_attributes">POBJECT_ATTRIBUTES</a> ObjectAttributes,
    _In_ HANDLE ThreadHandle,
    _In_opt_ ULONG64 Reserved
    );
</div><div class="ntdoc-code-footer">
#endif
</div></code></pre><div class="ntdoc-code-links"><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/180fe591126a8293c20073893ee575cc0b101dce/phnt/include/ntzwapi.h#L1273">View code on GitHub</a></div></div>
</div>
<div class="ntdoc-description">
<p>Creates a new thread state object. This object offers a more resilient alternative to suspending threads, tying the duration of the operation to the lifetime of the state object. To change the state of the thread state object, use <code><a href="ntchangethreadstate">NtChangeThreadState</a></code>.</p>

<h1 id="parameters">Parameters</h1>

<ul>
<li><code>ThreadStateChangeHandle</code> - a pointer to a variable that receives a handle to the new thread state object.</li>
<li><code>DesiredAccess</code> - the access mask to provide on the returned handle. This value is usually <code>THREAD_STATE_ALL_ACCESS</code>.</li>
<li><code>ObjectAttributes</code> - an optional pointer to an <code><a href="object_attributes">OBJECT_ATTRIBUTES</a></code> structure that specifies attributes of the new object/handle.</li>
<li><code>ThreadHandle</code> - a handle to the associated thread. The handle must grant <code>THREAD_SET_INFORMATION</code> access.</li>
<li><code>Reserved</code> - this parameter is unused and should be set to zero.</li>
</ul>

<h1 id="remarks">Remarks</h1>

<p>To avoid retaining unused resources, call <code><a href="ntclose">NtClose</a></code> to close the returned handle when it is no longer required. When the reference counter on the thread state object drops to zero, the system automatically undoes the effect of the state changes on the associated thread.</p>

<h1 id="related-win32-api">Related Win32 API</h1>

<p>This functionality is not exposed in Win32 API.</p>

<h1 id="required-os-version">Required OS version</h1>

<p>This function was introduced in Windows 11.</p>

<h1 id="see-also">See also</h1>

<ul>
<li><code><a href="ntchangethreadstate">NtChangeThreadState</a></code></li>
<li><code><a href="ntopenthread">NtOpenThread</a></code></li>
<li><code><a href="ntsuspendthread">NtSuspendThread</a></code></li>
</ul>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntcreatethreadstatechange.md">Edit description on GitHub</a>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
